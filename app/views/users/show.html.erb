<article class="module width_full">
  <header>
    <h3><%= t(:account_details) %></h3>
  </header>

  <div class="module_content">
    <table>
        <tr>
          <td><%= t(:date_joined) %></td>
          <td><%= time_ago_in_words(@user.created_at) + t(:ago) %></td>
        </tr>
        <tr>
          <td><%= t(:default_locale) %></td>
          <td><%= User::AVAILABLE_LANGUAGES[@user.locale ? @user.locale.to_sym : I18n.default_locale] %></td>
        </tr>
        <% if @user.role %>
        <tr>
          <td><%= t('role.name') %></td>
          <td><%= render 'shared/role', :role => @user.role_name %></td>
        </tr>
        <% end %>
    </table>
    <% if @my_profile %>
    <% content_for :on_ready_hook do %>
      $.make_sortable('my_assigned_issues', '<%= assigned_issues_sort_path %>');
    <% end %>
  <% end %>
  </div>
</article>

<article class="module width_full">
  <header>
    <h3><%= @my_profile ? t(:my_assigned_issues) : t('issue.issues_assigned_to', :username => @user.name) %></h3>
  </header>
  <div class="module_content">
    <div id="calendar">
      <% today = Date.today %>
      <% this_month = today.month %>
      <% beginning = today.beginning_of_week.yesterday %>
      <table border="0" class="calendar" cellspacing="0">
        <tr>
          <% (0..6).each do |i| %>
            <th><%= t('date.abbr_day_names')[i] %></th>
          <% end %>
        </tr>
        <% beginning = today.beginning_of_week %>
        <% beginning_to_today = (today - beginning).to_i - 1 %>
        <tr>
          <% if beginning.month < this_month %>
            <td class="past_month"><%= beginning.day %></td>
          <% else %>
            <td><%= beginning.day %></td>          
          <% end %>
          <% next_day = beginning.next %>
          <% beginning_to_today.times do %>
            <% if next_day.month < this_month %>
              <td class="past_month"><%= next_day.day %></td>
            <% else %>
              <td><%= next_day.day %></td>
            <% end %>
            <% next_day = next_day.next %>
          <% end %>
          <td class="today"><%= today.day %></td>
          <% next_day = today.next %>
          <% if beginning_to_today < 5 %>
            <% (5 - beginning_to_today).times do %>
              <% if next_day.month > this_month %>
                <td class="next_month"><%= next_day.day %></td>
              <% else %>
                <td><%= next_day.day %></td>
              <% end %>
              <% next_day = next_day.next %>
            <% end %>
          <% end %>
        </tr>
        <tr>
          <% 7.times do %>
            <% if next_day.month > this_month %>
              <td class="next_month"><%= next_day.day %></td>
            <% else %>
              <td><%= next_day.day %></td>
            <% end %>
            <% next_day = next_day.next %>
          <% end %>
        </tr>
      </table>
    </div>
    <div class="spacer"></div>
    <div id="my_assigned_issues" title="<%= t(:drag_issue_to_sort_priority) %>">
      <%= render :partial => 'my_assigned_issue',
        :collection => @user.assigned_issues.except_closed
      %>
    </div>
  </div>
</article>

<article class="module width_full">
  <header>
    <h3><%= t(:recently_created_issues) %></h3>
  </header>

  <div class="module_content">
    <%= render :partial => 'issues/issue',
      :collection => @user.issues.order('created_at DESC').limit(5), :as => :issue %>
  </div>
</article>
