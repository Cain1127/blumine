<!DOCTYPE html>
<html>
<head>
  <title><%= @title + ' - ' if @title %>BluMine</title>
  <%= javascript_include_tag :defaults %>
  <%= csrf_meta_tag %>

  <% # use 'blueprint' css framework %>
  <%= stylesheet_link_tag "bp/screen", :media => "screen, projection" %>
  <%= stylesheet_link_tag "bp/print", :media => "print" %>
  <!--[if lt IE 8]>
    <%= stylesheet_link_tag "bp/ie", :media => "screen, projection" %>
  <![endif]-->

  <%= stylesheet_link_tag :all %>
  <%= yield :head_hook %>
</head>
<body>
  <div id="header">
    <div class="container" style="background-color: #505759">
      <div id="logo" class="span-4">BluMine</div>
      <div class="span-10 links">
        <%= link_to t(:home), root_path %>
        <% if current_user %>
          <%= link_to t(:all_projects), projects_path %>
          <%= link_to current_user.name, current_user %>
          <%= link_to t(:log_out), logout_path %>
        <% else %>
          <%= link_to t(:register), register_path %>
          <%= link_to t(:log_in), login_path %>
        <% end %>
      </div>
    </div>
  </div>

  <% if breadcrumbs.items.length > 1 %>
    <div class="container">
      <div id="breadcrumbs">
        <%= breadcrumbs.render(:format => :inline) %>
      </div>
    </div>
  <% end %>

  <div class="container">
    <% [:notice, :error].each do |type| %>
      <% if flash[type] %>
        <div class="<%= type %>"><%= flash[type] %></div>
      <% end %>
    <% end %>
  </div>

  <div class="container" id="main_area">
    <div class="span-16" id="content">
      <%= yield %>
    </div>

    <div class="span-6 last" id="sidebar">
      <%= yield :sidebar %>
    </div>
  </div>
  <div class="container">
    <div id="footer">
      <span class="" style="background: url(/images/locales.png) no-repeat 0 50%; padding-left: 20px; float: left; font-size: 12px; line-height: 1.5em;">
        <% supported_locales = {:en => 'English', :zh => '中文'} %>
        <% supported_locales.keys.each do |key| %>
          <% if I18n.locale == key %>
            <span class="current"><%= supported_locales[key] %></span>
          <% else %>
            <%= link_to supported_locales[key], "?locale=#{key.to_s}", :class => :action %>
          <% end %>
        <% end %>
      </span>
      <span class="right">
        <%= link_to t(:get_source_code), 'http://github.com/daqing/blumine/' %>
        <%= link_to t(:blog), 'http://blog.xdaqing.com' %>
        &copy; <%= Time.now.year %> Project BluMine
      </span>
    </div>
  </div>
  <script type="text/javascript">
    $(function() {
      $.make_sortable = function(id, items, url) {
        var obj = $("#" + id);
        obj.sortable({
           axis: 'y',
           dropOnEmpty: false,
           cursor: 'crosshair',
           items: items,
           opacity: 0.6,
           scroll: true, 
           update: function(event, ui) {
              $.post(url, $("#" + id).sortable('serialize'), function(result) {}, 'script');
           }
        });
      }

      $(".bg_highlight").live('mouseenter', function() { $(this).css('backgroundColor', '#FFC'); })
        .live('mouseleave', function() { $(this).css('backgroundColor', '#FFF'); });

      $("div[clickable]").mouseover(function() { $(this).css('cursor', 'pointer'); }).click(function() {
        location.href = $(this).attr('clickable');
      });

      $("div.row").live('hover', function(ev) {
        if (ev.type == "mouseenter") {
          $(this).find('a[data-method=delete]').removeClass('hide');
        } else if (ev.type == "mouseleave") {
          $(this).find('a[data-method=delete]').addClass('hide');
        }
      });

      <%= yield :on_ready_hook %>

      $(".tip").tipTip({defaultPosition: 'left'});
    });
  </script>
</body>
</html>
